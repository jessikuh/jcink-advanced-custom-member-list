/**
 * A custom member list that utilizes user's custom fields.
 * Created by Jessica Stamos
 * https://github.com/jessikuh/jcink-advanced-custom-member-list
 */
"use strict";var submitSearchField=function(){document.querySelector("form.members-form").submit()},memberList=function(){var e=document.querySelector("#member-list"),t="".concat(location.protocol,"//").concat(location.host,"/index.php?act=Members&s="),r=document.createElement("div"),m="".concat(location.protocol,"//").concat(location.host,"/index.php?showuser="),n=document.createElement("div"),c=document.createElement("div"),o=Array.prototype.slice.call(document.querySelectorAll('select[name="filter"] option')),i=document.createElement("div"),a=document.createElement("div"),s=document.createElement("div"),l=document.querySelector('.member-search-input input[name="name"]'),d=[],u=Array.prototype.slice.call(e.querySelectorAll("td.name"));e.style.display="none",n.className="member-list",c.innerHTML='<div class="members"></div>',r.innerHTML='<div class="member-search-input"><input type="text" size="25" name="name" value="" placeholder="Search"></div>',i.innerHTML='<div class="member-select-groups"><select class="member-search-select" onchange="submitSearchField()" name="filter"></select></div>',a.innerHTML='<div class="member-search-links"></div>';var p=i.querySelector("select");o.forEach(function(e){var t=document.createElement("option"),r=document.createElement("a");t.value=e.value,t.id=e.text.toLowerCase().replace(/ /g,"-").replace(/'/g,""),t.text=e.text,p.appendChild(t),r.className="member-search-link",r.setAttribute("data-value",e.value),r.href="#",r.text=e.text,r.id=e.text.toLowerCase().replace(/ /g,"-").replace(/'/g,""),a.querySelector(".member-search-links").appendChild(r)}),s.innerHTML='<div class="clear-search"><a href="/index.php?act=Members">Clear Search</a>';var f={"{{clear-search}}":s.innerHTML,"{{members}}":c.innerHTML,"{{search-input}}":r.innerHTML,"{{search-links}}":a.innerHTML,"{{search-select}}":i.innerHTML},h=new RegExp(Object.keys(f).join("|"),"gi");function b(e,t,r,n,c,o){this.name=e,this.id=t,this.level=r,this.group=n,this.joined=c,this.posts=o}n.innerHTML+='<form class="members-form" action="'.concat(t,'" method="post">').concat(customMemberListWrapper.replace(h,function(e){return f[e]}),"</form>"),e.parentNode.insertBefore(n,e.nextSibling),l&&l.addEventListener("keyup",function(){13===event.keyCode&&document.querySelector("form.members-form").submit()}),Array.prototype.slice.call(document.querySelectorAll(".member-search-links a")).forEach(function(n){n.addEventListener("click",function(e){e.preventDefault();var t=n.getAttribute("data-value"),r=document.createElement("input");r.type="hidden",r.name="filter",r.value=t,document.querySelector("form.members-form").appendChild(r),document.querySelector("form.members-form").submit()})}),u.forEach(function(e){var t=e.textContent,r=e.querySelector("a").getAttribute("href"),n=r.substring(r.lastIndexOf("=")).replace("=",""),c=e.parentNode.querySelector("td.level").innerHTML,o=e.parentNode.querySelector("td.group").textContent,i=e.parentNode.querySelector("td.joined").textContent,a=e.parentNode.querySelector("td.posts").textContent;d.push(new b(t,n,c,o,i,a))}),d.forEach(function(a){fetch(m+a.id).then(function(e){return e.text()}).then(function(e){var o=(new DOMParser).parseFromString(e,"text/html"),t=o.querySelectorAll('[id*="memberList"]'),i={"{{group}}":a.group,"{{joined}}":a.joined,"{{level}}":a.level,"{{name}}":a.name,"{{posts}}":a.posts,"{{member-url}}":'<a class="member-link" href="'.concat(m).concat(a.id,'">'),"{{/member-url}}":"</a>"};t.forEach(function(e){var t=e.id.indexOf("-"),r=e.id.substr(t+1),n=o.querySelector("#memberList-"+r).innerHTML;if(-1<n.indexOf("script")){var c=n.substring(n.indexOf("{"),n.indexOf(";"));-1<c.indexOf("img")?c=c.substring(c.indexOf('"')+1,c.lastIndexOf('"')):-1<c.indexOf("document.write")&&(c=c.substring(c.indexOf("'")+1,c.lastIndexOf("'"))),-1<(n=n.substring(n.indexOf("'")+1,n.indexOf("=")-2)).indexOf("No Information")&&(n=c)}n=-1<n.indexOf("No Information")?"":n,i["{{".concat(r,"}}")]=n});var r=new RegExp(Object.keys(i).join("|"),"gi"),n=document.createElement("div"),c=a.group.toLowerCase().replace(/ /g,"-").replace(/'/g,"");n.id=c,n.className="member-container",n.innerHTML+="".concat(customMemberList.replace(r,function(e){return i[e]})),document.querySelector(".members").appendChild(n)})})};(-1<window.location.href.indexOf("index.php?act=Members")||-1<window.location.href.indexOf("index.php?&act=Members"))&&(memberList(),document.querySelector("form.members-form").className="members-form"),-1<window.location.href.indexOf("index.php?act=Members&s=")&&(document.querySelector("form.members-form").className+=" member-search-applied");